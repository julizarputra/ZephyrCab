<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["javascript"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="javascript">javascript</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='http://evilgeniustech.com'>EvilGeniusTech Blog</a></li>
            <li><a href="http://github.com/k4kfh/LocoThrottleJS" target="_blank">locoThrottle.js on GitHub</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>Welcome to the locoThrottle.js docs!</p>

<h1 id="interfacing-with-jmri">Interfacing with JMRI</h1>

<h2 id="the-jmri-object-introduction">The <code class="prettyprint">jmri</code> Object - Introduction</h2>

<p>The <code class="prettyprint">jmri</code> object is responsible for interfacing the rest of the program to your layout via JMRI. It communicates using JMRI&rsquo;s WebSockets JSON service, described <a href="http://jmri.sourceforge.net/help/en/html/web/JsonServlet.shtml">here</a>.</p>

<h2 id="websockets-basics">WebSockets Basics</h2>

<p>The code for this is spread amongst two files:</p>

<ul>
<li><code class="prettyprint">jmri-core.js</code></li>
<li><code class="prettyprint">websockets.js</code></li>
</ul>

<p>Naturally, most of the code to do with lower level WebSockets stuff (like connecting, sending raw JSON commands, etc) is in the <code class="prettyprint">websockets.js</code> file. In contrast, most of the code dealing with application-level things, such as the JMRI roster, is contained in <code class="prettyprint">jmri-core.js</code>.</p>

<h3 id="connecting-to-jmri">Connecting to JMRI</h3>

<blockquote>
<p>The IP address or hostname must be a string, but the port can be a normal JavaScript number.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">jmriAddress</span> <span class="o">=</span> <span class="s2">"192.168.1.10"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">jmriPort</span> <span class="o">=</span> <span class="mi">12080</span><span class="p">;</span>

<span class="nx">connect</span><span class="p">(</span><span class="nx">jmriAddress</span><span class="p">,</span> <span class="nx">jmriPort</span><span class="p">);</span>
</code></pre>

<p>Connecting to your JMRI PC is very simple. There is a function called <code class="prettyprint">connect()</code> which accepts two arguments:</p>

<ul>
<li><code class="prettyprint">ip</code> - This is the IP address (or hostname; that works too)</li>
<li><code class="prettyprint">port</code> - This is whatever port your JMRI web server is running on. The default is 12080, but you can use whatever you want.</li>
</ul>

<p>This function should not be dealt with by other developers. This should only be dealt with from the &ldquo;Connection&rdquo; page within locoThrottle.js, which provides an easy, simple GUI to connect to your layout with. The only reason this function is documented is for reference.</p>

<h3 id="sending-commands">Sending Commands</h3>

<blockquote>
<p>We have to have this variable as a string or it will break things. You should stringify your object if you have an actual object.
It&rsquo;s also very important to make sure the string contains double quotes. JMRI will return an error complaining that you didn&rsquo;t use double quotes if you try and use &rsquo; instead of &ldquo;, and you&rsquo;ll be unhappy.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">someCommand</span> <span class="o">=</span> <span class="s1">'{"list":"trains"}'</span><span class="p">;</span>

<span class="nx">sendcmd</span><span class="p">(</span><span class="nx">someCommand</span><span class="p">);</span>
</code></pre>

<blockquote>
<p>Since WebSockets is full-duplex, you can&rsquo;t use it like a question-answer style communication system. This function won&rsquo;t return what the server responds with, because the server could respond with anything at any time. There is a function called processReply() that handles this, so if you need to process a reply, you&rsquo;ll probably be out of luck unless you come make an issue on GitHub.</p>
</blockquote>

<p>Sending commands in raw JSON is very simple. It is handled by the <code class="prettyprint">sendcmd()</code> function, which behaves similar to the <code class="prettyprint">ws.send()</code> function, but also adds easy errors and user alerts when the connection has problems.</p>

<p><code class="prettyprint">sendcmd()</code> accepts 1 argument: a JSON object, as a string.</p>

<h2 id="jmri-roster">JMRI Roster</h2>

<p>locoThrottle.js provides a number of ways for interfacing with the JMRI roster. It also automatically kept up-to-date via the WebSockets service, so if you request roster data it will automatically be fed into all the roster variables and objects.</p>

<h3 id="roster-objects">Roster Objects</h3>

<p>There are two ways you can access the roster in locoThrottle.js:</p>

<ol>
<li><p>An array of objects, just as it is provided by JMRI</p></li>
<li><p>An object with sub-objects for each roster entry, with the roster entry name as the key</p></li>
</ol>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="javascript">javascript</a>
          </div>
      </div>
    </div>
  </body>
</html>
